#!/usr/bin/env python
# ________  ___    ___ ________ _______  _________  ________  ___  ___
#|\   __  \|\  \  /  /|\  _____\\  ___ \|\___   ___\\   ____\|\  \|\  \
#\ \  \|\  \ \  \/  / | \  \__/\ \   __/\|___ \  \_\ \  \___|\ \  \\\  \
# \ \   ____\ \    / / \ \   __\\ \  \_|/__  \ \  \ \ \  \    \ \   __  \
#  \ \  \___|\/  /  /   \ \  \_| \ \  \_|\ \  \ \  \ \ \  \____\ \  \ \  \
#   \ \__\ __/  / /      \ \__\   \ \_______\  \ \__\ \ \_______\ \__\ \__\
#    \|__||\___/ /        \|__|    \|_______|   \|__|  \|_______|\|__|\|__|
#         \|___|/
# Made by Kreato
# Licensed Under GPL3-Or-Later
import platform, psutil, os, getpass, shutil, distro
uname = platform.uname()
cpu = psutil.cpu_percent()
username = getpass.getuser()
ram = psutil.virtual_memory()
used = ram.used // (2**30)
total = ram.total // (2**30)
wm =  os.popen("wmctrl -m | grep dwm | awk -F'Name: ' '{printf $2}'").read()
totaldisk, useddisk, freedisk = shutil.disk_usage("/")
diskpercent_used = round(useddisk / totaldisk * 100, 2)
percent_used = round(ram.used / ram.total * 100, 2)
print(f"   {useddisk // (2**30)}GiB / {freedisk // (2**30)}GiB ({diskpercent_used}%)")
print(f"   {username}@{uname.node}")
print(f"   {uname.processor} ({cpu}%) ")
print(f"   {used}GiB / {total}GiB ({percent_used}%)")
print(f"   {wm}")
if os.name == 'posix':
    distro = distro.linux_distribution()
    result = ' '.join(map(str, distro)) 
    print(f"   {result} {uname.release}")
elif os.name == 'nt':
    print(f"   {uname.system} {uname.release}")

if 'Gentoo' in distro:
    import portage
    packages = len(portage.db["/"]["vartree"].dbapi.cpv_all())
    print(f"   {packages}")

# Experimental
if 'Arch' in distro:
    packages = os.popen('pacman -Q | wc -l').read()
    print(f"   {packages}")
