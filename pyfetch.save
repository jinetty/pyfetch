#!/usr/bin/env python
# ________  ___    ___ ________ _______  _________  ________  ___  ___
# |\   __  \|\  \  /  /|\  _____\\  ___ \|\___   ___\\   ____\|\  \|\  \
# \ \  \|\  \ \  \/  / | \  \__/\ \   __/\|___ \  \_\ \  \___|\ \  \\\  \
# \ \   ____\ \    / / \ \   __\\ \  \_|/__  \ \  \ \ \  \    \ \   __  \
#  \ \  \___|\/  /  /   \ \  \_| \ \  \_|\ \  \ \  \ \ \  \____\ \  \ \  \
#   \ \__\ __/  / /      \ \__\   \ \_______\  \ \__\ \ \_______\ \__\ \__\
#    \|__||\___/ /        \|__|    \|_______|   \|__|  \|_______|\|__|\|__|
#         \|___|/
# Made by Kreato
# Licensed Under GPL3-Or-Later

# import stuffs
import sys, platform, psutil, os, getpass, shutil
from colorama import init, Fore, Back, Style

# Setup colorama
init()

# get the args
args = sys.argv[1:]

# if needed print the help!
if "-h" in args or "--help" in args:
    # enjoy this lovely table made out of entirely unicode chars
    print('''pyfetch - a lighter and faster neofetch.
╔═════╦═══════════════════╦════════════════════════════════════════════════════╗
║ -c  ║ --cpu             ║ CPU info & usage                                   ║
╠═════╬═══════════════════╬════════════════════════════════════════════════════╣
║ -d  ║ --disk            ║ Disk usage                                         ║
╠═════╬═══════════════════╬════════════════════════════════════════════════════╣
║ -m  ║ --memory          ║ RAM usage                                          ║
╠═════╬═══════════════════╬════════════════════════════════════════════════════╣
║ -uh ║ --userhostname    ║ user@hostname                                      ║
╠═════╬═══════════════════╬════════════════════════════════════════════════════╣
║ -p  ║ --packages        ║ Installed package count                            ║
╠═════╬═══════════════════╬════════════════════════════════════════════════════╣
║ -os ║ --operatingsystem ║ Which OS you have                                  ║
╠═════╬═══════════════════╬════════════════════════════════════════════════════╣
║ -t  ║ --terminal        ║ What type of terminal you are using                ║
╠═════╬═══════════════════╬════════════════════════════════════════════════════╣
║ -wm ║ --windowmanager   ║ Your current window manager                        ║
╠═════╬═══════════════════╬════════════════════════════════════════════════════╣
║ -a  ║ --asciiart        ║ ASCII art for your Distro / OS, or a specified OS. ║
║═════╬═══════════════════╬════════════════════════════════════════════════════╣
║ -na ║ --noascii         ║ Disables ascii art                                 ║
╚═════╩═══════════════════╩════════════════════════════════════════════════════╝ ''')
    exit()

to_print = []
# this global bullshit is because python's scoping is dumb and decides that it'd
# rather shadow the var with a newly declared one than assign it a value
global print_index
print_index = 0

# ascii art
alpine = '''
   /\\ /\\     
  // \\  \\    
 //   \\  \\   
///    \\  \\  
//      \\  \\ 
         \\  \\
          \\  '''

endeavour = '''     /\\\\      
    //  \\\\\\\\  
   //    \\\\ \\\\
 / /     _) ) 
/_/___-- __-  
 /____--      '''


guix = '''|.__          __.|
|__ \\        / __|
   \\ \\      / /   
    \\ \\    / /    
     \\ \\  / /     
      \\ \\/ /      
       \\__/       '''


arch = '''      /\\      
     /^^\\     
    /\\   \\    
   /  __  \\   
  /  (  )  \\  
 / __|  |__\\\\ 
///        \\\\\\
'''

debian = '''  _____  
 /  __ \\ 
|  /    |
|  \\___- 
-_       
  --_    '''

fedora = '''     _____ 
    /   __/
   |  /    
  _|  |_   
 |_    _|  
   |  |    
 __/  |    
/____/     '''

freebsd = ''' _  _____     
/ \\\\\\`     \\`/
\\/       (__/ 
|           | 
|           | 
 \\         /  
  \\`-_____-\\` '''

gentoo = '''  .-----.      
.\\`    _  \\`.  
\\`.   (_)   \\`.
  \\`.        / 
 .\\`       .\\` 
/       .\\`    
\\____.-\\`      '''

linux = '''    ___
   (.. \\
   (<> |
  //  \\\\ \\\\
 ( |  | /|
_/\\\\ __)/_
\\/-____\\/'''

macos = '''       (/    
  .---__--.  
 /         \\ 
|         /  
|         \\\\_
 \\         / 
  \\`._.-._.\\`'''

manjaro = '''||||||||| ||||
||||||||| ||||
||||      ||||
|||| |||| ||||
|||| |||| ||||
|||| |||| ||||
|||| |||| ||||'''

nixos = '''  \\\\   \\\\ //  
 ==\\\\___\\\\/ //  
   //    \\\\// 
==//      //==
 //\\\\____//   
// /\\\\   \\\\== 
  // \\\\   \\\\  '''

openbsd = '''     _____    
   \\-     -/  
\\_/         \\ 
|        O O |
|_  <   )  3 )
/ \\         / 
   /-_____-\\  '''

raspbian = '''  __  __  
 (_\\)(/_)
 (_(__)_) 
(_(_)(_)_)
 (_(__)_) 
   (__)   '''

void = '''    _______    
    \\_____ \\`- 
 /\\   ___ \\`- \\
| |  /   \\  | |
| |  \\___/  | |
 \\ \\`-_____  \\/
  \\`-______\\   '''

windows = '''         /__---|
 /----| |      |
|-----| |------|
                
|-----| |------|
 \\----| |      |
         \\--___|
'''


# utlity functions for arrays
def append(array, index, item):
    if index + 1 < len(array):
        array[index] += item
    else:
        array.append(item)


def insert_at_start(array, index, item):
    if index < len(array):
        array[index] = item + array[index]
    else:
        array.append(item)

# ".lower()"" and "in" because im not confident i got these 100% correct
if os.name == 'posix':
	import distro
	current_distro = distro.linux_distribution()[0]
if "alpine" in current_distro.lower():
    ascii = alpine
    ascii_color = Fore.BLUE
elif "arch" in current_distro.lower():
    ascii = arch
    ascii_color = Fore.BLUE
elif "debian" in current_distro.lower():
    ascii = debian
    ascii_color = Fore.RED
elif "fedora" in current_distro.lower():
    ascii = fedora
    ascii_color = Fore.MAGENTA
elif "freebsd" in current_distro.lower():
    ascii = freebsd
    ascii_color = Fore.RED
elif "gentoo" in current_distro.lower():
    ascii = gentoo
    ascii_color = Fore.MAGENTA
elif "linux" in current_distro.lower():
    ascii = linux
    ascii_color = Fore.RESET
elif "mac" in current_distro.lower():
    ascii = macos
    ascii_color = Fore.RESET
elif "manjaro" in current_distro.lower():
    ascii = manjaro
    ascii_color = Fore.GREEN
elif "nix" in current_distro.lower():
    ascii = nixos
    ascii_color = Fore.BLUE
elif "openbsd" in current_distro.lower():
    ascii = openbsd
    ascii_color = Fore.YELLOW
elif "raspbian" in current_distro.lower():
    ascii = raspbian
elif "void" in current_distro.lower():
    ascii = void
    ascii_color = Fore.GREEN
elif "windows" == current_distro:
     ascii = windows
     ascii_color = Fore.BLUE
elif "guix" in current_distro.lower():
     ascii = guix
     ascii_color = Fore.YELLOW
elif "endeavour" in current_distro.lower():
     ascii = endeavour
     ascii_color = Fore.MAGENTA
else:
     ascii = "\n"
     ascii_color = Fore.RESET

# define important functions
def package_count():
    global print_index
    if os.name == "nt":
        return
    if os.name == 'posix':
        import distro
        current_distro = distro.linux_distribution()
    else:
        current_distro = ""
    # apt, if Debian make it red
    if len(os.popen("whereis apt").read()) > 5:
        packages = os.popen('apt-cache list --installed | wc -l').read()[:-1]
        append(to_print, print_index, ascii_color + " " + Fore.WHITE + f"  APT:  {packages}")
        print_index += 1

    # emerge, if Gentoo make it purple
    if len(os.popen("whereis emerge").read()) > 8:
        packages = os.popen("ls -d /var/db/pkg/*/* | wc -l | awk '{printf $1 }'").read()
        append(to_print, print_index, ascii_color + " " + Fore.WHITE + f"  Emerge:  {packages}")
        print_index += 1

    # pacman, if Arch make it blue
    if len(os.popen("whereis pacman").read()) > 8:
